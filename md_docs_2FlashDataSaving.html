<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Avionics: Restricted Flash Storage Specifications</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="clemson.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Avionics
   </div>
   <div id="projectbrief">Core avionics package for CURE flight computers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_docs_2FlashDataSaving.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Restricted Flash Storage Specifications </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md15"></a></p>
<p><b>The data examples shown below are relative to the MARTHA 1.3 hardware.</b></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md16"></a>
Variable Data Rates</h1>
<p>Not all sensor data needs to be stored at 100Hz. High-frequency data such as acceleration and gyroscope readings are critical for accurate calculations, while other values like temperature and magnetometer readings change more slowly and can be logged less frequently. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md17"></a>
<b>Data Save Rates (No Labels)</b></h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data <a class="el" href="classStream.html">Stream</a>  </th><th class="markdownTableHeadNone">Bytes per Save  </th><th class="markdownTableHeadNone">Saves per Second (Hz)  </th><th class="markdownTableHeadNone">Total Bytes per Second  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Altitude  </td><td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">100  </td><td class="markdownTableBodyNone">400  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Acceleration (x, y, z)  </td><td class="markdownTableBodyNone">12  </td><td class="markdownTableBodyNone">100  </td><td class="markdownTableBodyNone">1200  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Gyroscope (x, y, z)  </td><td class="markdownTableBodyNone">12  </td><td class="markdownTableBodyNone">100  </td><td class="markdownTableBodyNone">1200  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Temperature  </td><td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">4  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Magnetometer (x, y, z)  </td><td class="markdownTableBodyNone">12  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">12  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Flight Status  </td><td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">10  </td><td class="markdownTableBodyNone">40  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Timestamp  </td><td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">100  </td><td class="markdownTableBodyNone">400  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Super Loop Rate  </td><td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">4  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Flight ID  </td><td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">4  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Total</b>  </td><td class="markdownTableBodyNone">-  </td><td class="markdownTableBodyNone">-  </td><td class="markdownTableBodyNone"><b>3264</b> bytes/sec  </td></tr>
</table>
<h1 class="doxsection"><a class="anchor" id="autotoc_md18"></a>
<b>Maximum Storage Capacity</b></h1>
<p>The W25Q128 flash chip provides <b>128 megabits (16 megabytes)</b> of storage. At <b>3,264 bytes per second</b>, this allows for <b>4,901 seconds (~81 minutes) of storage</b>, assuming perfect efficiency (which is unrealistic due to metadata overhead). <br  />
</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md19"></a>
<b>Metadata Storage</b></h1>
<p>The flash chip consists of <b>4,096 sectors</b>, with each sector spanning <b>4,096 addresses</b> (16³). We reserve <b>Sector 1</b> for metadata, as data can only be erased one sector at a time. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md20"></a>
<b>Metadata Layout</b></h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Address Range  </th><th class="markdownTableHeadNone">Function  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><span class="tt">0x000000</span> (1 byte)  </td><td class="markdownTableBodyNone"><span class="tt">0x01</span>: Post-launch mode active, <span class="tt">0x00</span>: Normal mode  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><span class="tt">0x000001 – 0x000005</span> (4 bytes)  </td><td class="markdownTableBodyNone">Stores the address of "sacred" data (protected launch data)  </td></tr>
</table>
<p>Excluding metadata, <b>15.9959MB</b> remains available, reducing storage by only **~1 second**. <br  />
</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md21"></a>
<b>Writing Strategy</b></h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md22"></a>
<b>Sensor Data Handling</b></h2>
<p>Each sensor data handler writes to a global data saver that manages flash storage. Each handler can configure its <b>save rate</b> based on the table in Fig. 1. <br  />
</p>
<ul>
<li><b>Each data point requires 5 bytes</b>: <br  />
<ul>
<li><b>1 byte</b>: Label <br  />
</li>
<li><b>4 bytes</b>: Data (<span class="tt">float</span> or <span class="tt">uint32_t</span>) <br  />
</li>
</ul>
</li>
<li><b>Example</b>: Z-acceleration (<span class="tt">0x02</span> label) <br  />
</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md23"></a>
<b>Byte5 Data Format</b></h2>
<p>The <b>Byte5 format</b> ensures flexible and efficient storage: <br  />
</p><ul>
<li><b>1st byte</b>: <span class="tt">uint8_t</span> enum (identifies data type) <br  />
</li>
<li><b>Next 4 bytes</b>: <span class="tt">float</span> or <span class="tt">uint32_t</span> <br  />
</li>
</ul>
<p>To optimize performance, data is <b>buffered in RAM</b> and written <b>one full 256-byte page at a time</b>, reducing write cycles. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md24"></a>
<b>Byte5 Data Breakdown (Per 256-Byte Page)</b></h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data  </th><th class="markdownTableHeadNone">Labels  </th><th class="markdownTableHeadNone">Padding  </th><th class="markdownTableHeadNone">Bytes per Page  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">204  </td><td class="markdownTableBodyNone">51  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">256  </td></tr>
</table>
<p>This results in <b>20.3% storage waste</b>, balancing efficiency and flexibility. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md25"></a>
<b>Data Save Rates (Byte5 Format)</b></h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data <a class="el" href="classStream.html">Stream</a>  </th><th class="markdownTableHeadNone">Bytes per Save  </th><th class="markdownTableHeadNone">Saves per Second (Hz)  </th><th class="markdownTableHeadNone">Total Bytes per Second  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Altitude  </td><td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone">100  </td><td class="markdownTableBodyNone">500  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Acceleration (x, y, z)  </td><td class="markdownTableBodyNone">15  </td><td class="markdownTableBodyNone">100  </td><td class="markdownTableBodyNone">1500  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Gyroscope (x, y, z)  </td><td class="markdownTableBodyNone">15  </td><td class="markdownTableBodyNone">100  </td><td class="markdownTableBodyNone">1500  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Temperature  </td><td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">5  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Magnetometer (x, y, z)  </td><td class="markdownTableBodyNone">15  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">15  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Flight Status  </td><td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone">10  </td><td class="markdownTableBodyNone">50  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Timestamp  </td><td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone">100  </td><td class="markdownTableBodyNone">500  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Super Loop Rate  </td><td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">5  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Flight ID  </td><td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">5  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Total</b>  </td><td class="markdownTableBodyNone">-  </td><td class="markdownTableBodyNone">-  </td><td class="markdownTableBodyNone"><b>4080</b> bytes/sec  </td></tr>
</table>
<p>At <b>4,080 bytes/sec</b>, storage lasts <b>3,921 seconds (~65 minutes)**—sufficient for a **5-minute launch</b>. <br  />
</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md26"></a>
<b>Alternative Approach: 64-Byte Chunks</b></h1>
<p>A <b>64-byte chunk method</b> was considered to eliminate padding and labels by storing fixed-size blocks. This would perfectly align with <b>256-byte flash pages</b>. <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md27"></a>
<b>Proposed 64-Byte Data Chunk</b></h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data Type  </th><th class="markdownTableHeadNone">Bytes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Acceleration (x, y, z)  </td><td class="markdownTableBodyNone">12  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Gyroscope (x, y, z)  </td><td class="markdownTableBodyNone">12  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Magnetometer (x, y, z)  </td><td class="markdownTableBodyNone">12  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Altitude  </td><td class="markdownTableBodyNone">4  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Pressure  </td><td class="markdownTableBodyNone">8  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Temperature (LSM6DSOX)  </td><td class="markdownTableBodyNone">4  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Temperature (BMP390)  </td><td class="markdownTableBodyNone">4  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Timestamp  </td><td class="markdownTableBodyNone">4  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Flag  </td><td class="markdownTableBodyNone">4  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Total</b>  </td><td class="markdownTableBodyNone"><b>64</b>  </td></tr>
</table>
<h2 class="doxsection"><a class="anchor" id="autotoc_md28"></a>
<b>Why We Rejected the 64-Byte Chunk Method</b></h2>
<ol type="1">
<li><b>Forced Uniform Save Rates</b> <br  />
<ul>
<li>Data that doesn’t change frequently (e.g., temperature, magnetometer) is saved at <b>100Hz</b>, <b>wasting 24 bytes per chunk</b> (or <b>96 bytes per page</b>). <br  />
</li>
<li>This results in <b>37.5% storage waste</b>, compared to <b>20.3% with Byte5</b>. <br  />
</li>
</ul>
</li>
<li><b>No Flexibility for New Metrics</b> <br  />
<ul>
<li>Cannot add new debug data without removing an existing field. <br  />
</li>
</ul>
</li>
<li><b>Byte5 Allows Dynamic Data Logging</b> <br  />
<ul>
<li>Byte5 enables <b>variable save rates</b>, reducing wasted space. <br  />
</li>
<li>If we <b>later need</b> 64-byte chunks at 100Hz, we can revisit this method. <br  />
</li>
</ul>
</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md29"></a>
<b>Post-Launch Data Protection</b></h1>
<p>To avoid losing launch data due to circular buffering, we implement a <b>post-launch mode</b>:</p>
<ol type="1">
<li><b>Launch Detection</b> <br  />
<ul>
<li>When launch occurs, the system <b>marks the current data address</b> as the start of <b>"sacred" data</b>. <br  />
</li>
</ul>
</li>
<li><b>Protecting Critical Post-Launch Data</b> <br  />
<ul>
<li>New data <b>cannot overwrite launch data</b>. Only the <b>next hour of data</b> is recorded. <br  />
</li>
</ul>
</li>
<li><b>Metadata Persistence</b> <br  />
<ul>
<li>A <b>post-launch mode flag</b> is stored in <b>metadata</b> to prevent overwriting on reboot. <br  />
</li>
</ul>
</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md30"></a>
<b>Summary</b></h2>
<ul>
<li><b>Byte5 format</b> provides <b>flexibility &amp; reduced waste</b>. <br  />
</li>
<li><b>64-byte chunks</b> force unnecessary data logging and are <b>less adaptable</b>. <br  />
</li>
<li><b>Post-launch mode</b> ensures we retain the most valuable flight data. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
</body>
</html>
